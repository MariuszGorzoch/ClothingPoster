<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="MoniTTa.jpg" rel="apple-touch-icon"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Manrope%3Awght%40400%3B500%3B700%3B800&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#1173d4",
              "background-light": "#f6f7f8",
              "background-dark": "#101922",
            },
            fontFamily: {
              display: ["Manrope"],
            },
            borderRadius: { DEFAULT: "0.25rem", lg: "0.5rem", xl: "0.75rem", full: "9999px" },
          },
        },
      };
    </script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<title>Clothing Poster app</title>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="font-display bg-background-light dark:bg-background-dark">
<div class="flex flex-col h-screen justify-between">
<div class="flex-grow overflow-y-auto">
<main>
<header class="sticky top-0 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm z-10 px-4 pt-6 pb-4">
  <div class="flex items-center justify-between gap-4">
    <h1 class="text-2xl font-bold text-black dark:text-white">Add Product</h1>
    <button
      class="flex size-12 items-center justify-center rounded-full bg-black/5 text-black transition hover:bg-black/10 dark:bg-white/10 dark:text-white dark:hover:bg-white/20"
      id="closeButton"
      type="button"
      aria-label="Close"
    >
      <span class="material-symbols-outlined text-3xl leading-none"> close </span>
    </button>
  </div>
  </header>
  <section class="p-4 space-y-4 pb-28">
    <h2 class="font-bold text-lg text-black dark:text-white">Photos</h2>
    <input accept="image/*" class="hidden" hidden id="productPhotos" multiple type="file"/>
    <div class="space-y-3" id="photoPreview" role="list"></div>
  </section>
</main>
</div>
  <footer class="sticky bottom-0 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm border-t border-black/10 dark:border-white/10">
    <nav class="flex justify-around items-center h-16 px-4">
      <button
        class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors"
        id="addPhotosButton"
        type="button"
      >
        <span class="material-symbols-outlined text-3xl leading-none">add_photo_alternate</span>
        <span class="text-xs font-medium">Add photo</span>
      </button>
      <button
        class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50"
        id="createProductButton"
        type="button"
      >
        <span class="material-symbols-outlined text-3xl leading-none">done</span>
        <span class="text-xs font-medium">Create product</span>
      </button>
    </nav>
    <div class="pb-safe"></div>
  </footer>
</div>
<script>
    const addPhotosButton = document.getElementById("addPhotosButton");
    const productPhotosInput = document.getElementById("productPhotos");
    const photoPreview = document.getElementById("photoPreview");
    const createProductButton = document.getElementById("createProductButton");
    const closeButton = document.getElementById("closeButton");
    const MAX_PHOTOS = 5;
    let selectedFiles = [];

    const updateCreateButtonState = () => {
      createProductButton.disabled = productPhotosInput.files.length === 0;
    };

    const syncInputFiles = () => {
      const dataTransfer = new DataTransfer();
      selectedFiles.forEach((file) => dataTransfer.items.add(file));
      productPhotosInput.files = dataTransfer.files;
      updateCreateButtonState();
    };

    const renderPreview = () => {
      photoPreview.innerHTML = "";

      if (selectedFiles.length === 0) {
        photoPreview.className = "space-y-3";

        const emptyState = document.createElement("div");
        emptyState.className =
          "flex flex-col items-center justify-center gap-3 rounded-lg border border-dashed border-black/20 bg-white/60 p-10 text-center text-black/70 dark:border-white/30 dark:bg-background-dark/40 dark:text-white/70";

        const emptyIcon = document.createElement("span");
        emptyIcon.className = "material-symbols-outlined text-4xl";
        emptyIcon.textContent = "image";

        const emptyMessage = document.createElement("p");
        emptyMessage.className = "text-sm";
        emptyMessage.textContent = "No photos yet. Add up to 5 product photos using the button below.";

        emptyState.appendChild(emptyIcon);
        emptyState.appendChild(emptyMessage);
        photoPreview.appendChild(emptyState);
        return;
      }

      photoPreview.className = "space-y-3";

      selectedFiles.forEach((file, index) => {
        const previewItem = document.createElement("div");
        previewItem.className = "relative w-full rounded-lg overflow-hidden border border-black/10 dark:border-white/10";
        previewItem.setAttribute("role", "listitem");

        const removeButton = document.createElement("button");
        removeButton.type = "button";
        removeButton.className = "absolute top-3 right-3 bg-black/70 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm";
        removeButton.setAttribute("aria-label", `Remove ${file.name}`);
        removeButton.textContent = "âœ•";
        removeButton.addEventListener("click", () => {
          selectedFiles = selectedFiles.filter((_, fileIndex) => fileIndex !== index);
          syncInputFiles();
          renderPreview();
        });

        const image = document.createElement("img");
        image.alt = file.name;
        image.className = "w-full h-auto object-cover";

        const reader = new FileReader();
        reader.onload = (event) => {
          image.src = event.target.result;
        };
        reader.readAsDataURL(file);

        previewItem.appendChild(image);
        previewItem.appendChild(removeButton);
        photoPreview.appendChild(previewItem);
      });
    };

    addPhotosButton.addEventListener("click", () => {
      productPhotosInput.click();
    });

    productPhotosInput.addEventListener("change", (event) => {
      const incomingFiles = Array.from(event.target.files);
      productPhotosInput.value = "";
      let limitExceeded = false;

      incomingFiles.forEach((file) => {
        const isDuplicate = selectedFiles.some(
          (existingFile) =>
            existingFile.name === file.name &&
            existingFile.size === file.size &&
            existingFile.lastModified === file.lastModified
        );

        if (isDuplicate) {
          return;
        }

        if (selectedFiles.length >= MAX_PHOTOS) {
          limitExceeded = true;
          return;
        }

        selectedFiles.push(file);
      });

      if (limitExceeded) {
        alert(`You can only select up to ${MAX_PHOTOS} photos.`);
      }

      syncInputFiles();
      renderPreview();
    });

    const setCreateButtonState = (isSubmitting) => {
      if (isSubmitting) {
        createProductButton.disabled = true;
        createProductButton.dataset.originalText = createProductButton.textContent;
        createProductButton.textContent = "Uploading...";
      } else {
        createProductButton.disabled = selectedFiles.length === 0;
        if (createProductButton.dataset.originalText) {
          createProductButton.textContent = createProductButton.dataset.originalText;
          delete createProductButton.dataset.originalText;
        }
      }
    };

    createProductButton.addEventListener("click", async () => {
      if (selectedFiles.length === 0) {
        return;
      }

      const formData = new FormData();
      selectedFiles.forEach((file, index) => {
        formData.append(`file${index + 1}`, file);
      });

      try {
        setCreateButtonState(true);
        const response = await fetch("https://clothingposterappservice-ada8b4eahpfxbrd6.polandcentral-01.azurewebsites.net/products/add", {
          method: "POST",
          body: formData,
        });

        if (!response.ok) {
          throw new Error("Failed to upload product images.");
        }

        window.location.href = "jobs.html";
      } catch (error) {
        console.error(error);
        alert("There was a problem uploading the product. Please try again.");
        setCreateButtonState(false);
      }
    });

    syncInputFiles();
    renderPreview();

    closeButton.addEventListener("click", () => {
      window.location.href = "index.html";
    });
  </script>
</body></html>
