<!DOCTYPE html>
<html lang="pl"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="yes" name="mobile-web-app-capable"/>
<meta content="yes" name="apple-touch-fullscreen"/>
<meta content="Clothing Poster" name="apple-mobile-web-app-title"/>
<link href="manifest.webmanifest" rel="manifest"/>
<link href="MoniTTa.jpg" rel="apple-touch-icon"/>
<title>Clothing Poster</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script defer src="pwa.js"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1173d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Manrope"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="flex flex-col h-screen justify-between">
<div class="flex-grow overflow-y-auto">
<header class="sticky top-0 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm z-10 px-4 pt-6 pb-4">
<div class="flex items-center justify-between">
<h1 class="text-2xl font-bold text-black dark:text-white">Produkty</h1>
</div>
</header>
<main class="px-4 pb-4">
<div class="space-y-3" id="product-list" role="list"></div>
</main>
</div>
<footer class="sticky bottom-0 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm border-t border-black/10 dark:border-white/10">
<nav class="flex justify-around items-center h-16">
      <a class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" href="add.html">
        <span aria-hidden="true" class="material-symbols-outlined text-2xl leading-none">add_box</span>
        <span class="text-xs font-medium">Utwórz</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" href="vintage.html">
        <span aria-hidden="true" class="material-symbols-outlined text-2xl leading-none">download</span>
        <span class="text-xs font-medium">Importuj</span>
      </a>
      <button class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" id="refresh-products" type="button">
        <span aria-hidden="true" class="material-symbols-outlined text-2xl leading-none">refresh</span>
        <span class="text-xs font-medium">Odśwież</span>
      </button>
      <a class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" href="jobs.html">
        <span aria-hidden="true" class="material-symbols-outlined text-2xl leading-none">work</span>
        <span class="text-xs font-medium">Zadania</span>
      </a>
      <a class="flex flex-col items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors" href="#">
        <span aria-hidden="true" class="material-symbols-outlined text-2xl leading-none">settings</span>
        <span class="text-xs font-medium">Ustawienia</span>
      </a>
</nav>
<div class="pb-safe"></div>
</footer>
</div>

</div>

<script>
  const productListElement = document.getElementById("product-list");

  function renderProductCard(product) {
    const card = document.createElement("div");
    card.className = [
      "p-3",
      "rounded-lg",
      "flex",
      "items-center",
      "gap-4",
      "transition-colors",
      "border",
      "border-transparent",
      "bg-white",
      "dark:bg-background-dark/50",
      "hover:bg-primary/5",
      "hover:border-primary/40",
      "cursor-pointer",
    ].join(" ");
    card.setAttribute(
      "aria-label",
      `Zarządzaj produktem ${product.Attributes?.Title ?? "Bez nazwy"}`
    );
    card.tabIndex = 0;
    const productId = product?.Id ?? "";
    const handleNavigation = () => {
      if (!productId) {
        return;
      }

      window.location.href = `manage.html?productId=${encodeURIComponent(productId)}`;
    };
    card.addEventListener("click", handleNavigation);
    card.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        handleNavigation();
      }
    });
    const imageUrl = Array.isArray(product.Images) && product.Images.length > 0 ? product.Images[0] : "";
    const image = document.createElement("div");
    image.className = "bg-center bg-no-repeat aspect-square bg-cover rounded size-16 flex-shrink-0";
    if (imageUrl) {
      image.style.backgroundImage = `url("${imageUrl}")`;
    } else {
      image.classList.add("bg-black/10", "dark:bg-white/10");
    }

    const body = document.createElement("div");
    body.className = "flex flex-1 items-center gap-4";

    const content = document.createElement("div");
    content.className = "flex-1";

    const title = document.createElement("p");
    title.className = "text-black dark:text-white font-semibold";
    title.textContent = product.Attributes?.Title ?? "Bez nazwy";

    content.appendChild(title);

    card.appendChild(image);
    body.appendChild(content);

    card.appendChild(body);

    return card;
  }

  function renderError(message) {
    const errorCard = document.createElement("div");
    errorCard.className = "bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200 p-4 rounded-lg";
    errorCard.textContent = message;
    productListElement.innerHTML = "";
    productListElement.appendChild(errorCard);
  }

  async function loadProducts() {
    try {
      productListElement.innerHTML = "";
      const response = await fetch("https://clothingposterappservice-ada8b4eahpfxbrd6.polandcentral-01.azurewebsites.net/products");
      if (!response.ok) {
        throw new Error(`Nie udało się wczytać produktów (${response.status})`);
      }

      const products = await response.json();
      if (!Array.isArray(products) || products.length === 0) {
        const emptyCard = document.createElement("div");
        emptyCard.className = "bg-white dark:bg-background-dark/50 p-4 rounded-lg text-gray-500 dark:text-gray-400";
        emptyCard.textContent = "Brak dostępnych produktów.";
        productListElement.appendChild(emptyCard);
        return;
      }

      products.forEach((product) => {
        const card = renderProductCard(product);
        productListElement.appendChild(card);
      });
    } catch (error) {
      renderError("Nie można wczytać produktów. Spróbuj ponownie później.");
      console.error("Błąd podczas wczytywania produktów", error);
    }
  }

  const refreshButton = document.getElementById("refresh-products");
  if (refreshButton) {
    refreshButton.addEventListener("click", () => {
      loadProducts();
    });
  }

  loadProducts();
</script>
</body></html>